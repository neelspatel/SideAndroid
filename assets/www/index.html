<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
  
    <script src="http://10.2.80.141:8080/target/target-script-min.js#anonymous"></script>

     <!-- <script src="http://10.0.0.5:8080/target/target-script-min.js#anonymous"></script> -->

    <script type="text/javascript" charset="utf-8" src="js/cordova-1.6.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/cdv-plugin-fb-connect.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/facebook_js_sdk.js"></script>
    
    <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
    <script src="js/handlebars.js"></script>
    <script src="js/scrollstop.js"></script>
    <script src="js/jquery.lazyload.min.js"></script>
    <script src="js/badger.js"></script>

    <title>Side</title>

    <link rel="shortcut icon" href="favicon.png"/>

    <link rel="stylesheet" href="css/custom.css">

    <link rel="stylesheet" href="css/badger.css">
        
    <script type="text/javascript">
        var friendIDs = [];
        var friendNames = [];
        var friendGenders = [];
        var friendMutualFriends = [];               
        var userInfo = {};
        var gameRequest, trainingRequest, profileRequest;
        var onGame = false;
        var currentTab = "Game";

        var currentStatusScore = 0;
        var currentNotifs = 0;
        var currentAnswers = 0;
        var currentRecs = 0;
        var currentUGAnswers = 0;
        
        var globalAnswerAgreeStatuses;

        document.addEventListener("deviceready", onDeviceReady, false);                         

        function onDeviceReady() {                    
            console.log("index.html loaded");   

            //shows login
            $(".login").show();

            //checks facebook status
            //attemptes facebook login (if necessary)
            try {               
                FB.init({
                    appId : "545929018807731",
                    nativeInterface : CDV.FB,
                    useCachedDialogs : false
                });             
                

                //if we have a facebook id already
                if(localStorage.getItem("sideFacebookID"))
                {
                    FB.getLoginStatus(function(response) {
                    if (response.status === 'connected') {
                        var accessToken = response["authResponse"]["accessToken"];
                        console.log("Access token is " + accessToken);

                        //switches to the next screen
                        init();
                    } else                 
                        // the user isn't logged in to Facebook.
                        login();            
                    });
                }
                else //otherwise force login
                {
                    login();
                }               
                
            } catch (e) {
                console.log(e);
            }
        }

        //---------------------------------LOGIN-------------------------       
        function sendNewAccessToken(accessToken) {  
            FB.api('/me', function(response) 
            {           
                console.log("Response from me: " + JSON.stringify(response));

                localStorage.setItem("sideFacebookID", response.id);

                $.ajax({
                    type: 'POST',
                    url: "http://54.214.234.140/data/createuser/",
                    data: {"access_token": accessToken},
                    beforeSend: function() { 
                        console.log("about to send info for new user"); 
                    },
                    success: function(data){ 
                        //saves everything locally
                        localStorage.setItem("friends", JSON.stringify(data["friends"]));
                        localStorage.setItem("genders", JSON.stringify(data["genders"]));
                        localStorage.setItem("names", JSON.stringify(data["names"]));
                        localStorage.setItem("top_friends", JSON.stringify(data["top_friends"]));

                        console.log("hey, all submitted for the new user.");    
                        init();                        
                    },
                    error: function(error){ 
                        alert("error in creating new access token :("); 
                        alert(JSON.stringify(error)); data.innerHTML = data.innerHTML + JSON.stringify(error) + " ";
                    }
                });
            });                     
        };          

        function login() {
            FB.login(function(response) {
                if (response.authResponse) {
                    console.log("Logging in now");
                    var accessToken = response["authResponse"]["accessToken"];
                    
                    //updates user params, and switches to the next screen
                    sendNewAccessToken(accessToken);
                } else {
                    console.log('error, not logged in');
                }
            }, {
                scope : "user_about_me, user_relationships, user_birthday, user_location"               
            });
        };

        function logout() {
            FB.logout(function(response) {
                console.log("Logged out.");
                $(".login").show();
            });
        };

        function init() {               
            console.log("init called");   
            //sets notification timer
            setTimeout(getNotifications, 10000);
                 
            //gets the game feed if there's not one yet
            if(localStorage.getItem("gameFeed"))   
            {
                console.log("gameFeed exists");
                var data = JSON.parse(localStorage.getItem("gameFeed"));
                //loads everything in
                var Source = document.getElementById("Game-Handlebars-Template").textContent;                   
                var Template = Handlebars.compile(Source);
                var HTML = Template({ Data : data });                            
                //Replace the body section with the new code.      
                console.log("Returned: " + HTML);                 
                $('.content').append(HTML);             
                
                $("img").lazyload({
                    //container: $(".content")
                    event: "scrollstop"
                });  
                
                //the purpose of this is to oad the initial images in view
                $(window).resize(); 
            }
            else
            {
                console.log("gameFeed doesn't exist");
                getGameFeed();    
            }
            

            //saves user id TEMPORARILY
            localStorage.setItem("sideFacebookID", 1256912018);

            //assigns the click listener to the image in the game
            $('.content').on('click tap', '.gameImage', function(){
                console.log("Clicked");
                var row = $(this).closest('.row');  
                var img = $(this).closest('img');   
                var data = $(this).closest('.row').data().all;

                //checks if we've clicked this row yet
                if($(this).closest('.row').data("clicked"))
                {
                    console.log("Yeee clicked this already.");
                }     
                else
                {
                    //adds a border to this one
                    //img.css({'background-color': '#FFFFCC'});
                    //img.css("border", "rgba(25,97,166,1) solid 10px");          
                    //img.css("margin", "10px");                      

                    //otherwise, set is as clicked in the data and perform the click action
                    $(this).closest('.row').data("clicked", true);  
                    console.log("You answered '" + data.questionText + "' for " + data.name + "(" + data.friend + "), with choice " + img.attr("class") );

                    //finally, save it in localstorage
                    if(img.attr("class") == "left gameImage")
                    {
                        $(this).closest('.row').prepend("<div class = 'leftCheckMark'>Hey</div>");

                        console.log("Saving the left image");
                        saveAnswer(data.friend, data.product1, data.product2, data.currentQuestion);
                    }
                    else if(img.attr("class") == "right gameImage")
                    {
                        $(this).closest('.row').prepend("<div class = 'rightCheckMark'>Hey</div>");

                        console.log("Saving the right image");
                        saveAnswer(data.friend, data.product2, data.product1, data.currentQuestion);
                    }                
                }                   
            }); 

            //assigns the click listener to the image in training
            $('.content').on('click tap', '.trainingImage', function(){
                console.log("Clicked");
                var row = $(this).closest('.row');  
                var img = $(this).closest('img');   
                var data = $(this).closest('.row').data().all;

                //checks if we've clicked this row yet
                if($(this).closest('.row').data("clicked"))
                {
                    console.log("Yeee clicked this already.");
                }     
                else
                {
                    //adds a border to this one
                    img.css({'background-color': '#FFFFCC'});
                    img.css("border", "rgba(25,97,166,1) solid 10px");          
                    img.css("margin", "10px");  

                    //otherwise, set is as clicked in the data and perform the click action
                    $(this).closest('.row').data("clicked", true);  
                    console.log("You answered '" + data.questionText + "' in training, with choice " + img.attr("class") );

                    //finally, save it in localstorage
                    if(img.attr("class") == "left trainingImage")
                    {
                        console.log("Saving the left image");
                        saveTrainingAnswer(data.product1, data.product2, data.currentQuestion);
                    }
                    else if(img.attr("class") == "right trainingImage")
                    {
                        console.log("Saving the right image");
                        saveTrainingAnswer(data.product2, data.product1, data.currentQuestion);
                    }

                    //moves to the nextone
                    getTrainingQuestion();                
                }                   
            }); 

            //assigns the click listener to the agreebutton in the profile
            $('.content').on('click tap', '.answerAgree', function(){
                var data = $(this).closest('.row').data().all;

                var key = data.question + data.friend + data.chosenProductID + data.otherProductID;
                console.log("Key in tap is : " + key);
                //var hash = hash(key);
                var hash = key;
                var answerAgreeStatuses = localStorage.getItem("answerAgreeStatuses");
                if(!answerAgreeStatuses)
                {
                    answerAgreeStatuses = {key: 1};
                }
                else
                {
                    answerAgreeStatuses = JSON.parse(answerAgreeStatuses);
                    answerAgreeStatuses[key] = 1;
                }

                $(this).html("Agreed set");

                localStorage.setItem("answerAgreeStatuses", JSON.stringify(answerAgreeStatuses));
            });

            //assigns the click listener to the disagreebutton in the profile
            $('.content').on('click tap', '.answerDisagree', function(){
                var data = $(this).closest('.row').data().all;

                var key = data.question + data.friend + data.chosenProductID + data.otherProductID;
                console.log("Key in tap is : " + key);
                //var hash = hash(key);
                var hash = key;
                var answerAgreeStatuses = localStorage.getItem("answerAgreeStatuses");
                if(!answerAgreeStatuses)
                {
                    answerAgreeStatuses = {key: 0};
                }
                else
                {
                    answerAgreeStatuses = JSON.parse(answerAgreeStatuses);
                    answerAgreeStatuses[key] = 0;
                }

                $(this).html("Disagreed set");

                localStorage.setItem("answerAgreeStatuses", JSON.stringify(answerAgreeStatuses));
            });           

            //THIS SECTION IS FOR SHOWING AND HIDING TABS
            $("#toGame").on("click", function() {
                console.log("Clicked on toGame");

                storeScrollState();

                //if we're not already here
                if(currentTab != "Game")
                {
                    console.log("Updating game now");
                    //clear 
                    $(".content").html("");

                    //check if we have any feedObjects
                    if(localStorage.getItem("gameFeed"))
                    {
                        console.log("Got gamefeed from localstorage");
                        //now sets the html
                        //Get the Template from above
                        var Source = document.getElementById("Game-Handlebars-Template").textContent;                   
                        //Compile the actual Template file
                        var Template = Handlebars.compile(Source);                 
                        //Generate some HTML code from the compiled Template
                        var HTML = Template({ Data : JSON.parse(localStorage.getItem("gameFeed")) });
                        console.log("Got html from gamefeed");

                        //Replace the body section with the new code. 
                        $('.content').append(HTML);
                        
                        $("img").lazyload({
                            //container: $(".content")
                            event: "scrollstop"
                        });  
                        
                        //the purpose of this is to oad the initial images in view
                        $(window).resize();

                        //scrolls to the right place
                        $(window).scrollTop(localStorage.getItem("gameScroll"));
                    }
                    else
                    {
                        getGameFeed();
                    }
                }
                currentTab = "Game";
            });
            
            $("#toProfile").on("click", function() {
                console.log("Clicked on toProfile");

                //clears the badges
                $("#toProfile").badger("");
                currentRecs = 0;
                currentAnswers = 0;
                currentUGAnswers = 0;

                storeScrollState();
                //clear 
                $(".content").html("");                

                currentTab = "Profile";

                //Get the Template from above
                var Source = document.getElementById("Profile-Header-Handlebars-Template").textContent;                   
                //Compile the actual Template file
                var Template = Handlebars.compile(Source);

                //Generate some HTML code from the compiled Template
                var HTML = Template({});                

                //Replace the body section with the new code.      
                console.log("Returned: " + HTML);                 
                $('.content').html(HTML);

                getAnswersAboutMe();
            });
            
            $("#toTraining").on("click", function() {
                console.log("Clicked on toTraining");

                storeScrollState();
                $(".content").html("In training!");
                currentTab = "Training";

                getTrainingQuestion();
            });

            //buttons in profile
            $('.content').on('click tap', '#answersAboutMe', function() 
            {
                console.log("Clicked on answersAboutMe");         
                getAnswersAboutMe();
            });

            $('.content').on('click tap', '#insightsForMe', function() 
            {
                console.log("Clicked on insightsForMe");
                getInsightsForMe();
            });

        }

        function getNotifications () {
            $.getJSON( "http://54.214.234.140/data/getnotification/1256912018/?nocache=" + (new Date).getTime(), function( json ) {
                console.log("Got notification text as " + JSON.stringify(json));
                currentStatusScore += json.status_score;
                currentRecs += json.recs;
                currentAnswers += json.answers;
                currentUGAnswers += json.ug_answers;

                var total = currentRecs + currentAnswers + currentUGAnswers;
                
                if(total != 0)
                {
                    $("#toProfile").badger(total + "");
                }

                setTimeout(getNotifications, 30000);
            });         
        }

        function checkForInsight() {
            if(currentStatusScore >= 100)
            {
                //request the recommendation
                $.getJSON( "http://54.214.234.140/data/getnewrec/1256912018/?nocache=" + (new Date).getTime(), function( json ) {

                    if(json.url) //if it has proper data
                    {
                        alert(json.text);
                    }
                }
            }
        }

        function storeScrollState() {
            console.log("Storing scroll state");
            if(currentTab == "Game")
            {
                console.log("Storing scroll state for game");
                localStorage.setItem("gameScroll", $(window).scrollTop() );
            }
            else if(currentTab == "Profile")
            {
                console.log("Storing scroll state for profile");
                localStorage.setItem("profileScroll", $(window).scrollTop() );
            }
            else if(currentTab == "Training")
            {
                console.log("Storing scroll state for training");
                localStorage.setItem("trainingScroll", $(window).scrollTop() );
            }
        }
        
        function getUserID() {
            //first tries getting it from localstorage
            var id = localStorage.getItem("sideFacebookID");
            
            if(id) // if it exists
            {
                console.log("Got the user id, it is " + id);
                return id;
            }           
            else //otherwise logs in and tries to get it
            {
                console.log("Getting the used id from facebook.");
                FB.api('/me', function(response) 
                {                    
                    localStorage.setItem("sideFacebookID", response.id);
                    
                    //now tries again
                    getUserID();
                });
            
            }       
        }

//---------------------FUNCTIONS FOR IN APP     

        function getGameFeed() {
            console.log("going ot get game feed");
            //sets the data for tab0
            gameRequest = $.getJSON( "http://54.214.234.140/data/newgetlistquestions/1256912018/?nocache=" + (new Date).getTime(), function( json ) {                                   
                //appends to the array in localstorage
                if(localStorage.getItem("gameFeed"))
                {
                    var oldString = localStorage.getItem("gameFeed");

                    //splices the two together
                    oldString = oldString.substring(0, oldString.length - 1);
                    var newString = JSON.stringify(json);
                    newString = newString.substring(1, newString.length);
                    oldString = oldString + "," + newString;                    
                    localStorage.setItem("gameFeed", oldString);

                    //if the list is too long, remove some elements
                    if(JSON.parse(oldString).length > 300)
                    {
                        var parsed = JSON.parse(oldString);
                        var length = parsed.length;
                        var smaller = parsed.slice(length - 300, length);
                        localStorage.setItem("gameFeed", JSON.stringify(smaller));
                    }
                }
                else
                {
                    localStorage.setItem("gameFeed", JSON.stringify(json));
                }

                if(currentTab == "Game")                    
                {
                    //Get the Template from above
                    var Source = document.getElementById("Game-Handlebars-Template").textContent;                   
                    //Compile the actual Template file
                    var Template = Handlebars.compile(Source);                 
                    //Generate some HTML code from the compiled Template
                    var HTML = Template({ Data : json });                            
                    //Replace the body section with the new code.      
                    console.log("Returned: " + HTML);                 
                    $('.content').append(HTML); 
                         
                    /**                           
                    $("img").lazyload({
                        event: "scrollstop",
                        effect : "fadeIn",
                        container: $("#inner")
                     });
                    */                    
                    
                    $("img").lazyload({
                        //container: $(".content")
                        event: "scrollstop"
                    });  
                    
                    //the purpose of this is to oad the initial images in view
                    $(window).resize();       
                }                       
            });
        } 

        function getTrainingFeed() {
            console.log("going to get training feed");
            //sets the data for tab2
            trainingRequest = $.getJSON( "http://54.214.234.140/data/traininggetlistquestions/1256912018/?nocache=" + (new Date).getTime(), function( json ) {                                   
                
                localStorage.setItem("trainingFeed", JSON.stringify(json));

                //now updates the UI to reflect these new qs  
                getTrainingQuestion();                        
            });
        }       

        function getTrainingQuestion () {
            if(currentTab == "Training")                    
            {
                //gets the stored list of questions
                var data = localStorage.getItem("trainingFeed");

                //checks if the list exists
                //checks if we have enough items in the array
                if(!data || data.length <= 2)
                {
                    getTrainingFeed();
                }
                else
                {
                    var list = JSON.parse(data);

                    //gets the first element, and also removes it
                    var first = list.shift();

                    console.log("First item in training is " + JSON.stringify(first));

                    //saves the new list in localstorage
                    localStorage.setItem("trainingFeed", JSON.stringify(list));

                    //Get the Template from above
                    var Source = document.getElementById("Training-Handlebars-Template").textContent;                   
                    //Compile the actual Template file
                    var Template = Handlebars.compile(Source);                 
                    //Generate some HTML code from the compiled Template
                    var HTML = Template({ Data : [first] });                            
                    //Replace the body section with the new code.      
                    console.log("Returned: " + HTML);                 
                    $('.content').html(HTML);   
                    $("img").lazyload({
                        //container: $(".content")
                        event: "scrollstop"
                    });  
                    
                    //the purpose of this is to oad the initial images in view
                    $(window).resize();     
                }
                                 
            }  
        }

        function getAnswersAboutMe() {            
            //loads read statuses into memory
            globalAnswerAgreeStatuses = localStorage.getItem("answerAgreeStatuses");

            //loads from localstorage first if possible
            if(localStorage.getItem("answersAboutMe"))
            {
                if(currentTab == "Profile")                    
                {
                    //Get the Template from above
                    var Source = document.getElementById("AnswersAboutMe-Handlebars-Template").textContent;                   
                    //Compile the actual Template file
                    var Template = Handlebars.compile(Source);                 
                    //Generate some HTML code from the compiled Template
                    var HTML = Template({ Data : JSON.parse(localStorage.getItem("answersAboutMe")) });                            
                    //Replace the body section with the new code.
                    console.log("Returned: " + HTML);                 
                    $('#profileFeeds').html(HTML);
                    
                    $("img").lazyload({
                        //container: $(".content")
                        event: "scrollstop"
                    });  
                    
                    //the purpose of this is to oad the initial images in view
                    $(window).resize();       
                } 
            }
            else
            {
                profileRequest = $.getJSON( "http://54.214.234.140/data/getallfeedobjects/1256912018/?nocache=" + (new Date).getTime(), function( json ) {         
                
                    localStorage.setItem("answersAboutMe", JSON.stringify(json));
                    
                    getAnswersAboutMe();
                });
            }
            
        }

        function getInsightsForMe() {            
            //sets the data for tab0

            //loads from localstorage first if possible
            if(localStorage.getItem("insightsForMe"))
            {
                if(currentTab == "Profile")                    
                {
                    //Get the Template from above
                    var Source = document.getElementById("Insights-Handlebars-Template").textContent;                   
                    //Compile the actual Template file
                    var Template = Handlebars.compile(Source);                 
                    //Generate some HTML code from the compiled Template
                    var HTML = Template({ Data : JSON.parse(localStorage.getItem("insightsForMe")) });                            
                    //Replace the body section with the new code.
                    console.log("Returned: " + HTML);                 
                    $('#profileFeeds').html(HTML);
                    
                    $("img").lazyload({
                        //container: $(".content")
                        event: "scrollstop"
                    });  
                    
                    //the purpose of this is to oad the initial images in view
                    $(window).resize();       
                } 
            }
            else
            {
                profileRequest = $.getJSON( "http://54.214.234.140/data/getreclist/1256912018/?nocache=" + (new Date).getTime(), function( json ) {         
                
                    localStorage.setItem("insightsForMe", JSON.stringify(json));
                    
                    getInsightsForMe();
                });
            }
            
        }

        function saveAnswer(friendID, chosen, wrong, question) {
            $.ajax({
                type: 'POST',
                url: "http://54.214.234.140/data/newanswer/",
                data: {
                    "id_facebookID": getUserID(),
                    "id_forFacebookID": friendID,
                    "id_chosenProduct": chosen,
                    "id_wrongProduct": wrong,
                    "id_question": question                    
                },
                beforeSend: function() { 
                    
                },
                success: function(data){ 
                    
                },
                error: function(error){ 
                    console.log("error :("); 
                    console.log(JSON.stringify(error));
                }
            });
        }  

        function saveTrainingAnswer(chosen, wrong, question) {
            $.ajax({
                type: 'POST',
                url: "http://54.214.234.140/data/newanswer/",
                data: {
                    "id_facebookID": getUserID(),
                    "id_forFacebookID": getUserID(),
                    "id_chosenProduct": chosen,
                    "id_wrongProduct": wrong,
                    "id_question": question,                  
                    "is_training": "True"
                },
                beforeSend: function() { 
                    
                },
                success: function(data){ 
                    
                },
                error: function(error){ 
                    console.log("error :("); 
                    console.log(JSON.stringify(error));
                }
            });
        }     

        function hash(s) {
            return s.split("").reduce(function(a,b){a=((a<<5)-a)+b.charCodeAt(0);return a&a},0);              
        }
        
        //ties listener to the scrolling action        
        var timer = 0;
        $(window).scroll( function () {
            if (timer) {
                clearTimeout(timer);
            }

            //resets bottom navbar position dynamically
            //$("#bottomNav").css('bottom', -24 - ($(window).scrollTop()));
            //$("#bottomNav").css('bottom', -24);

            // Use a buffer so we don't call myCallback too often.
            timer = setTimeout(updateGameWithScroll, 500);
        });
            

        function updateGameWithScroll() {
            if (currentTab == "Game")
            {
                //scrolling inside tab0
                
                if($(window).scrollTop() + $(window).height() == $(".content").height()) {
                    getGameFeed();
                    console.log("at bottom");
                }
            }
            else
            {
                //scrolling outside of tab0
                console.log("scrolling outside of tab0");
            }
        }                  

        //handlebars functions
        Handlebars.registerHelper('getLeftImage', function(url) {
            //url = url.replace(/\+/, "%2b");
            //url = url.replace(/ /g, "+")      
            //url = "https://s3.amazonaws.com/pave_product_images/" + url   
            url = '<img data-original="' + url + '" src="images/grey.gif" height="118" width="134" class = "left gameImage" style = "margin:5px;">'                    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getRightImage', function(url) {
            //url = url.replace(/\+/, "%2b");
            //url = url.replace(/ /g, "+")      
            //url = "https://s3.amazonaws.com/pave_product_images/" + url   
            url = '<img data-original="' + url + '" src="images/grey.gif" height="118" width="134" class = "right gameImage" style = "margin:5px;">'    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getLeftImageProfile', function(url) {
            //url = url.replace(/\+/, "%2b");
            //url = url.replace(/ /g, "+")      
            //url = "https://s3.amazonaws.com/pave_product_images/" + url   
            url = '<img data-original="' + url + '" src="images/grey.gif" height="50" width="50" class = "left profileImage" style = "margin:5px;">'                    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getRightImageProfile', function(url) {
            //url = url.replace(/\+/, "%2b");
            //url = url.replace(/ /g, "+")      
            //url = "https://s3.amazonaws.com/pave_product_images/" + url   
            url = '<img data-original="' + url + '" src="images/grey.gif" height="50" width="50" class = "right profileImage" style = "margin:5px;">'    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getLeftImageTraining', function(url) {            
            url = '<img data-original="' + url + '" src="images/grey.gif" height="70" width="70" class = "left trainingImage" style = "margin:20px;">'                    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getRightImageTraining', function(url) {              
            url = '<img data-original="' + url + '" src="images/grey.gif" height="70" width="70" class = "right trainingImage" style = "margin:20px;">'    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getProfilePicture', function(friend) {           
            url = "https://graph.facebook.com/" + friend + "/picture"
            url = "<img data-original='" + url + "' src='images/grey.gif' height='60' width='60' style = 'float:left;'>"   
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getProfilePictureTraining', function(friend) {           
            url = "https://graph.facebook.com/" + localStorage.getItem("sideFacebookID") + "/picture"
            url = "<img data-original='" + url + "' src='images/grey.gif' height='30' width='30' style = 'float:left;'>"   
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getAnswerAgreeButton', function(object) {  
            console.log("In agree ");
            var key = object.question + object.friend + object.chosenProductID + object.otherProductID;

            console.log("key is " + key);
            //var hash = hash(key);
            var hash = key;
            //console.log("Hash is " + hash);
            var answerAgreeStatuses = localStorage.getItem("answerAgreeStatuses");
            var button;
            if(answerAgreeStatuses !== null)
            {
                answerAgreeStatuses = JSON.parse(answerAgreeStatuses);
                console.log("answerAgreeStatuses Exists");
                if(answerAgreeStatuses[key] == 1) //if it's an agree
                {
                    button = '<button class = "answerAgree">Agreed</button>';
                }
                else
                {
                    button = '<button class = "answerAgree">Agree</button>';
                }
            }
            else
            {
                console.log("answerAgreeStatuses doesnt exist");
                button = '<button class = "answerAgree">Agree</button>';
            }
            return new Handlebars.SafeString(button);

        });

        Handlebars.registerHelper('getAnswerDisagreeButton', function(object) {  
            console.log("In disagree ");
            var key = object.question + object.friend + object.chosenProductID + object.otherProductID;

            console.log("key is " + key);
            //var hash = hash(key);
            var hash = key;
            //console.log("Hash is " + hash);
            var answerAgreeStatuses = localStorage.getItem("answerAgreeStatuses");
            var button;
            if(answerAgreeStatuses !== null)
            {
                answerAgreeStatuses = JSON.parse(answerAgreeStatuses);
                console.log("answerAgreeStatuses Exists");
                if(answerAgreeStatuses[key] == 0) //if it's a disagree
                {
                    button = '<button class = "answerDisgree">Disagreed</button>';
                }
                else
                {
                    button = '<button class = "answerDisgree">Disagree</button>';
                }
            }
            else
            {
                console.log("answerAgreeStatuses doesnt exist");
                button = '<button class = "answerDisgree">Disagree</button>';
            }
            return new Handlebars.SafeString(button);

        });

        Handlebars.registerHelper('getInsightAgreeButton', function(object) {  
            var button = '<button class = "insightAgree">Agree</button>';
            
            return new Handlebars.SafeString(button);
        });

        Handlebars.registerHelper('getInsightDisagreeButton', function(object) {  
            var button = '<button class = "insightDisagree">Disagree</button>';
            
            return new Handlebars.SafeString(button);
        });

        Handlebars.registerHelper('getInsightImage', function(url) {
            url = '<img data-original="' + url + '" src="images/grey.gif" height="100" width="100" class = "insightImage" style = "margin:20px;">'    
            return new Handlebars.SafeString(url);
        });

        Handlebars.registerHelper('getObject', function(context) {             
            //return new Handlebars.SafeString(JSON.stringify(context));
            return JSON.stringify(context);
        });                 
    </script>
    
</head>
<body ontouchstart="">    
    <script id="Game-Handlebars-Template" type="text/x-handlebars-template">             
        {{#each Data}}
            <div style = "height:260px; padding: 5px; display:block;" class = "row" data-all='{{getObject this}}'>
                {{getProfilePicture friend}} <span style = "display:block; height: 60px;"> {{questionText}} </span>
                </br>
                {{getLeftImage image1}}
                {{getRightImage image2}}
                <input type="hidden" value='{{getObject this}}'>
                <input class = "clickedyet" type="hidden" value='no'>
            </div>
        {{/each}}
    </script>

    <script id="Profile-Header-Handlebars-Template" type="text/x-handlebars-template">             
        <div class = "profileHeading">
            <button id = "answersAboutMe">Answers about me</button>
            <button id = "insightsForMe">Insights for me</button>

        </div>

        <div id = "profileFeeds">
        </div>        
    </script>

    <script id="AnswersAboutMe-Handlebars-Template" type="text/x-handlebars-template">             
        {{#each Data}}
            <div style = "height:120px; padding: 10px; display:block;" class = "row" data-all='{{getObject this}}'>
                {{getProfilePicture friend}} <span style = "display:block; height: 30px; background-color: rgb(16,154,220); color: white;"> {{question}} </span>
                </br>
                {{getAnswerAgreeButton this}} 
                {{getLeftImageProfile chosenProduct}}
                {{getRightImageProfile otherProduct}}               
                {{getAnswerDisagreeButton this}}
                <input type="hidden" value='{{getObject this}}'>
                <input class = "clickedyet" type="hidden" value='no'>
            </div>
        {{/each}}
    </script>

    <script id="Insights-Handlebars-Template" type="text/x-handlebars-template">             
        {{#each Data}}
            <div style = "height:120px; padding: 10px; display:block;" class = "row" data-all='{{getObject this}}'>
                <span style = "display:block; height: 30px;"> {{text}} </span>
                </br>
                {{getInsightAgreeButton this}} 
                {{getInsightImage url}}               
                {{getInsightDisagreeButton this}}
                <input type="hidden" value='{{getObject this}}'>
                <input class = "clickedyet" type="hidden" value='no'>
            </div>
        {{/each}}
    </script>

    <script id="Training-Handlebars-Template" type="text/x-handlebars-template">             
        
        {{#each Data}}
            <div style = "height:120px; padding: 10px; display:block;" class = "row" data-all='{{getObject this}}'>
                {{getProfilePictureTraining}} <span style = "display:block; height: 30px;"> {{questionText}} </span>
                </br>
                {{getLeftImageTraining image1}}
                {{getRightImageTraining image2}}
                <input type="hidden" value='{{getObject this}}'>
                <input class = "clickedyet" type="hidden" value='no'>
            </div>  
        {{/each}}      
    </script>

    <div class = "page">
        <div class="header">        
            Side
            <div>
                Statusbarhere
            </div>
        </div>
        
        <div class="content">            

        </div>

        <div class="footer" id = "bottomNav">
            
            
                <a href="#" class="action" id = "toProfile"><i class="icon-new-message"></i>Profile</a>
                <a href="#" class="action" id = "toGame"><i class="icon-new-message"></i>Game</a>
                <a href="#" class="action" id = "toTraining"><i class="icon-new-message"></i>Training</a>        
                    
        </div>
    </div>

    <div class = "login">
        Hey, we're at login.
    </div>
</body>
</html>